# 飞秋通讯重构 - 架构决策

## 关键设计决策

### 决策1：分层架构

**决策时间：** 2026-01-30

**决策内容：** 采用严格的分层架构

- 前端层（UI展示）
- Hook层（IPC调用封装）
- Store层（状态管理）
- IPC层（薄层：参数转换 + 错误映射）
- Service层（业务逻辑）
- Repository层（数据访问）
- Database层（ORM）

**理由：**

1. 职责清晰，易于维护
2. 符合业界最佳实践
3. 便于单元测试
4. 降低耦合度

**影响：**

- 需要创建新的Service层
- IPC层需要重构为薄层
- 前端需要添加Hook层

### 决策2：保持IPC接口兼容

**决策时间：** 2026-01-30

**决策内容：** IPC命令签名保持不变

**理由：**

1. 前端无需修改接口调用
2. 降低重构风险
3. 支持渐进式迁移

**影响：**

- Service层完成后，IPC层只做简单的参数转换
- 新功能通过Service层添加，但IPC接口保持稳定

### 决策3：结构化错误处理

**决策时间：** 2026-01-30

**决策内容：** 使用FrontendError替代字符串错误

**理由：**

1. 前端可以区分错误类型
2. 提供更好的用户体验
3. 便于错误追踪和调试

**影响：**

- 创建新的错误类型系统
- 前端需要适配新的错误处理逻辑
- IPC命令返回类型改变（但外部接口通过序列化保持兼容）

### 决策4：事件系统细粒度

**决策时间：** 2026-01-30

**决策内容：** 发布细粒度事件，减少订阅者解析负担

**理由：**

1. 订阅者职责更单一
2. 提高事件系统效率
3. 降低订阅者复杂度

**影响：**

- 需要在发布事件时解析包内容
- 新增多条细粒度事件类型
- 需要确保事件不丢失

### 决策5：渐进式迁移

**决策时间：** 2026-01-30

**决策内容：** 每个阶段独立验证，支持回滚

**理由：**

1. 降低整体风险
2. 问题早期发现
3. 每个里程碑可独立交付

**影响：**

- 需要保留原始代码备份
- 每个阶段完成后需要全面测试
- 可能需要并行维护新旧代码
